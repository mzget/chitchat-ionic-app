<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge" />
	<meta name="viewport" content="width=device-width, initial-scale=1" />
	<meta name="description" content="" />
	<meta name="author" content="" />
	<link href="favicon.ico" type="image/x-icon" rel="shortcut icon" />

	<title>ChitChat App</title>

	<link rel="stylesheet" href="css/bootstrap.min.css" />
	<link rel="stylesheet" href="css/bootstrap-theme.min.css" />
	<link rel="stylesheet" href="style.css" />
	<script src="js/angular.min.js"></script>
	<script src="js/jquery.min.js"></script>
	<script src="js/bootstrap.min.js"></script>
	<script src="js/require.js" data-main="scripts/appBundle"></script>
	<script src="scripts/appBundle.js"></script>

</head>

<body>

	<div id="login" class="row-fluid">
		<div class="container">
			<div class="row center">
				<img src="images/logo-main.png" alt="" width="40%" /><br />
				<label class="message">username or password is not valid.</label><br />
				<form action="#" method="post">
					<div class="form-group has-feedback">
						<input type="email" name="email" class="form-control" placeholder="Email" />
						<span class="glyphicon glyphicon-envelope form-control-feedback"></span>
					</div>
					<div class="form-group has-feedback">
						<input type="password" name="password" class="form-control" placeholder="Password" />
						<span class="glyphicon glyphicon-lock form-control-feedback"></span>
					</div>
					<div class="row">
						<div class="col-xs-8">
							<div class="checkbox icheck">
								<label class="text-white">
									<input type="checkbox" /> Remember Me
								</label>
							</div>
						</div>
						<div class="col-xs-4">
							<button id="btn-login" class="btn btn-primary btn-block btn-flat">Sign In</button>
						</div>
					</div>
				</form>
				<a href="list.html">Go to list</a>
			</div>
		</div>
	</div>

	<script type="text/javascript" src="js/jquery.cookie.min.js"></script>
	<!--<script type="text/javascript" src="/scripts/cordova.js"></script>-->
	<script type="text/javascript" src="js/index.js"></script>
<!--    <script src="https://cdn.socket.io/socket.io-1.3.5.js"></script> // Not support with newer version of socket.io -->
<script src="js/socket.io.js"></script>
<script>
	var socket = io;
</script>
<script type="text/javascript">
	app.initialize();
	var server = new ChatServer.ServerImplemented();

$('#btn-login').click(function(event){
	event.preventDefault();

	$('input').attr('readonly',true);
	email = $('form input[name="email"]').val();
	password = $('form input[name="password"]').val();

	server.logIn(email, password, (err, res) => {
		if (!err && res !== null) {
			window.location = "list.html";
		}
		else {
			console.log(err);
		}
	});
//	spartanEvent.addListenner();

	jQuery.support.cors = true;
	$.ajax({
		url: "http://stalk.animation-genius.com/index.php",
		data: { "r":"api/login", "username":email, "password":password },
		type: "GET",
		timeout: 30000,
		dataType: "text",
		success: function(data) {
			//alert(data);
			if(data == 'true')
			{
				//$.cookie('email', email, { expires:1 }); //Generate cookie
				//window.location = "list.html";
			}else{
				$('.message').css('opacity','1').delay(1000).animate({'opacity':'0'}, 1000, function(){
					$('.form-control').attr('readonly',false);
				});
			}
		},
		error: function(jqXHR, textStatus, ex) {
			alert(textStatus + "," + ex + "," + jqXHR.responseText);
		}
	});
});
	</script>
</body>
</html>
