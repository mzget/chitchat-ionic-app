<ion-view id="chatDetail" view-title="{{currentRoom.name}}" cache-view="false" hide-tab-bar>

	<ion-nav-buttons side="right">
		<div ng-show="currentRoom.type!=3">
	        <i ng-if="isFavorite(currentRoom._id)" class="ion-heart assertive" style="font-size:25px; line-height:40px;" ng-click="editFavorite('remove',currentRoom._id,currentRoom.type)"></i>
			<i ng-if="!isFavorite(currentRoom._id)" class="ion-heart dark" style="font-size:25px; line-height:40px;" ng-click="editFavorite('add',currentRoom._id,currentRoom.type)"></i>
		</div>
		<div ng-show="currentRoom.type==3">
	        <i ng-if="isFavorite(otherId)" class="ion-heart assertive" style="font-size:25px; line-height:40px;" ng-click="editFavorite('remove',otherId,currentRoom.type)"></i>
			<i ng-if="!isFavorite(otherId)" class="ion-heart dark" style="font-size:25px; line-height:40px;" ng-click="editFavorite('add',otherId,currentRoom.type)"></i>
		</div>

		<div ng-show="currentRoom.type==2">
			<i ng-if="isBlockNoti(currentRoom._id)" class="ion-android-notifications-off" style="margin-left:15px; margin-right:5px; font-size:25px; line-height:40px;" 
				ng-click="editBlockNoti('remove',currentRoom._id,currentRoom.type)"></i>
			<i ng-if="!isBlockNoti(currentRoom._id)" class="ion-android-notifications" style="margin-left:15px; margin-right:5px; font-size:25px; line-height:40px;"
				ng-click="editBlockNoti('add',currentRoom._id,currentRoom.type)"></i>
		</div>
		<div ng-show="currentRoom.type==3">
			<i ng-if="isBlockNoti(otherId)" class="ion-android-notifications-off" style="margin-left:15px; margin-right:5px; font-size:25px; line-height:40px;"
				ng-click="editBlockNoti('remove',otherId,currentRoom.type)"></i>
			<i ng-if="!isBlockNoti(otherId)" class="ion-android-notifications" style="margin-left:15px; margin-right:5px; font-size:25px; line-height:40px;"
				ng-click="editBlockNoti('add',otherId,currentRoom.type)"></i>
		</div>

    </ion-nav-buttons>
	
	<ion-content delegate-handle="mainScroll" style="bottom:44px;">    
        <div ng-controller="ImageController">
        	<div ng-controller="VoiceController">
        		<div ng-controller="VideoController">

        
		<ion-list class="message-list" ng-repeat="message in chat track by $index">

			<ion-item ng-if="message.firstMsg != undefined" style="text-align:center;">
				<div style="font-size:12px;"> {{message.firstMsg}} </div>
			</ion-item>

			<ion-item ng-if="message.sender != myprofile._id && !!message.sender" class="other item-remove-animate item-avatar item-icon-right" type="item-text-wrap">
				<img ng-src="http://203.113.25.44/timthumb.php?src={{allMembers[message.sender]['image']}}&h=40&w=40" />
				<h2>{{allMembers[message.sender]['displayname']}}</h2>
				</br>

				<p id="{{message._id}}" ng-if="message.type=='Text' && !isValidURI(message.body)">
					{{message.body}}
				</p>
				<p id="{{message._id}}" ng-if="message.type=='Text' && isValidURI(message.body)">
					<u ng-click="webview(message.body)">
						{{message.body}}
					</u>
				</p>
				
				
				<img id="{{message._id}}" class="type-img" ng-if="message.type=='Image'" ng-src="http://203.113.25.44{{message.body}}" ng-click="viewImage('http://203.113.25.44'+message.body)"/>
				<img class="type-img" ng-if="message.type=='Sticker'" ng-src="stickers/sticker{{message.body}}.png" />
				<div id="{{message._id}}" class="type-voice" ng-if="message.type=='Voice'">
					<i id="{{message._id}}-voice-play" class="ion-play" ng-click="play(message._id,'http://203.113.25.44'+message.body)"></i>
					<i id="{{message._id}}-voice-pause" class="ion-pause" ng-click="pause(message._id)" style="display:none;"></i>
				</div>

				<div class="type-video" ng-if="message.type=='Video'">
					<video id="{{message._id}}" src="{{message.bodyUrl}}"></video>
				</div>
            
				<div class="type-location" ng-if="message.type == 'Location'" ng-click="viewLocation(message._id)">
					<div class="card">
						<div class="item item-text-wrap">
							{{message.locationName}}     
                           <br /> {{message.locationAddress}}
                            <br /> {{message.lat}} , {{message.long}}
						</div>s
					</div>
				</div>
				

				<div id="{{message._id}}-downloaded" class="hide">
					<div id="{{message._id}}-download-contain" class="download-contain"><div id="{{message._id}}-download-progress" class="download-bar"></div></div>
				</div>

				</br>
				<label>{{message.createTime.substr(0,10)}} {{message.createTime.substr(11,8)}}</label>
			</ion-item>

			<ion-item ng-if="message.sender == myprofile._id" class="owner item-remove-animate item-icon-right" type="item-text-wrap">
				<label style="clear:none; cursor:pointer;" ng-show="message.readers != null && message.readers.length != 0" ng-click="viewReader(message.readers)">read {{message.readers.length}}</label> 

				<div id="{{message._id}}-resend" class="hide" style="font-size:10px;" ng-click="resend(message.body,message._id)"> Resend </div>

				<div id="{{message._id}}-downloaded" class="hide">
					<i class="ion-ios-close" style="margin-right:5px; float:left;" ng-click="sentCancel(message._id)"></i>
					<div id="{{message._id}}-download-contain" class="download-contain"><div id="{{message._id}}-download-progress" class="download-bar"></div></div>
				</div>
			
				<p id="{{message._id}}" ng-if="message.type=='Text' && !isValidURI(message.body)">
					{{message.body}}
				</p>
				<p id="{{message._id}}" ng-if="message.type=='Text' && isValidURI(message.body)">
					<u ng-click="webview(message.body)">
						{{message.body}}
					</u>
				</p>
				
                <img class="type-img" ng-if="message.type=='Image' && message.temp=='true'" ng-init="uploadImage(message._id)" ng-src="{{message.body}}" ng-click="viewImage(message.body)"/>
				<img class="type-img" ng-if="message.type=='Image' && message.temp==null" ng-src="http://203.113.25.44{{message.body}}" ng-click="viewImage('http://203.113.25.44'+message.body)"/>
				<img class="type-img" ng-if="message.type=='Sticker'" ng-src="stickers/sticker{{message.body}}.png" />

				<div id="{{message._id}}" class="type-voice" ng-if="message.type=='Voice' && message.temp=='true'" ng-init="uploadVoice(message._id)">
                    <i id="{{message._id}}-voice-play" class="ion-play" ng-click="play(message._id,message.body)"></i>
                    <i id="{{message._id}}-voice-pause" class="ion-pause" ng-click="pause(message._id)" style="display:none;"></i>
				</div>
                <div id="{{message._id}}" class="type-voice" ng-if="message.type=='Voice' && message.temp==null">
                    <i id="{{message._id}}-voice-play" class="ion-play" ng-click="play(message._id,'http://203.113.25.44'+message.body)"></i>
                    <i id="{{message._id}}-voice-pause" class="ion-pause" ng-click="pause(message._id)" style="display:none;"></i>
                </div>

                <div class="type-video" ng-if="message.type=='Video' && message.temp=='true'" ng-init="uploadVideo(message._id)">
                	<video id="{{message._id}}" src="{{message.body}}" controls></video>
				</div>
                <div class="type-video" ng-if="message.type=='Video' && message.temp==null">
                	<video id="{{message._id}}" src="{{message.bodyUrl}}" controls></video>
                </div>
				
				
				<div class="type-location" ng-if="message.type == 'Location'" ng-click="viewLocation(message._id)">
					<div class="card">
						<div class="item item-text-wrap">
							{{message.locationName}}     
                           <br /> {{message.locationAddress}}
                            <br /> {{message.lat}} , {{message.long}}
						</div>
					</div>
				</div>
						
                <br />
				<label ng-if="message.temp != 'true' "> {{message.createTime.substr(0,10)}} {{message.createTime.substr(11,8)}}</label>
			</ion-item>
		</ion-list>

				</div>
			</div>
		</div>

	</ion-content>
</ion-view>
<ion-footer-bar id="chatMessage" align-title="left" class="bar-light" style="z-index:100;">
	<div class="buttons">
		<button id="chatMenu" ng-click="openModal()" class="button" style="width:76px; font-size:20px; padding:0 20px;"><i class="ion-ios-plus-outline"></i></button>
	</div>
	<input id="send_message" type="text" name="send_message" style="width:100%; height:33px; padding:0 10px; box-shadow:0 0 0 1px rgba(0,0,0,0.1) inset;" />
	<div class="buttons">
		<button id="sendMsg" class="button" style="width:76px; font-size:20px; padding:0 20px;"><i class="ion-share" data-pack="default" data-tags="outbound"></i></button>
	</div>
</ion-footer-bar>
