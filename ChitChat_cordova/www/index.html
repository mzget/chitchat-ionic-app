<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no, width=device-width" />
	<title></title>

	<link href="lib/ionic/css/ionic.css" rel="stylesheet" />
	<link href="css/style.css" rel="stylesheet" />

	<!-- IF using Sass (run gulp sass first), then uncomment below and remove the CSS includes above
	<link href="css/ionic.app.css" rel="stylesheet" />
	-->
	<!-- ionic/angularjs js -->
	<script src="lib/ionic/js/ionic.bundle.js"></script>

	<!-- cordova script (this will be a 404 during development) -->
	<script src="cordova.js"></script>

	<!-- your app's js -->
	<script src="js/app.js"></script>
	<script src="js/controllers.js"></script>
	<script src="js/services.js"></script>
	<script src="js/jquery.min.js"></script>
	<script src="js/require.js" data-main="scripts/appBundle"></script>
	
	<script src="js/template.js"></script>
	
	<script src="scripts/appBundle.js"></script>

</head>
<body ng-app="starter">    
	
	<script src="js/socket.io.js"></script>
	<script>
		var socket = io;
		var main = new Main();
		var server = new ChatServer.ServerImplemented();
		var authen = server.authenData;
		
		setTimeout(function(){
			server.init(function () {
				console.log("token: ", authen.token);
				if (!authen.token) {
					//formLogin();
					
					$('body #login #btn-login').click(function (event) {
						event.preventDefault();						
						$('body #login input').attr('readonly', true);
						email = $('body #login form input[name="email"]').val();
						password = $('body #login form input[name="password"]').val();

						main.getHashService(password, function(err, res) {
						    main.authenUser(server, email, res, function () {
						        console.log("Manual Login ******************", main.getDataManager().myProfile.displayname);
							});
						});
					});
				}
				else {
					server.TokenAuthen(authen.token, function (err, res) {
						if (!err && res !== null) {
							console.log("Authen result: ", JSON.stringify(res));
							if (res.success) {
							    main.authenUser(server, res.username, res.password, function () {
							        console.log("Auto Login ******************", main.getDataManager().myProfile.displayname);
									$('#login').css({'display':'none'});
									$('.bar-stable.nav-bar-container').css({'display':''});
									location.href = "#/tab/group";
									
									console.log('+++++++++++'+main.getDataManager().orgMembers);
								});
							}
						}
					});
				}
			})
		}, 1500);
		
	</script>

    <ion-nav-bar class="bar-stable">
        <ion-nav-back-button>
        </ion-nav-back-button>
    </ion-nav-bar>
    <ion-nav-view></ion-nav-view>

</body>
</html>
