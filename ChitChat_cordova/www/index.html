<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>React Tutorial</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/0.13.3/react.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-core/5.8.23/browser.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/0.3.2/marked.min.js"></script>
</head>
<body>
    <div id="content"></div>
    <script src="js/require.js" data-main="scripts/appBundle"></script>
    <script type="text/javascript" src="scripts/appBundle.js">   </script>
    <script src="js/socket.io.js"></script>
	<script>
		var socket = io;
		var main = new Main();
		var server = new ChatServer.ServerImplemented();
		var chatRoomApi = new ChatServer.ChatRoomApiProvider();
		var authen = server.authenData;

		var dummy = new Dummy();
		var bot = dummy.getBot();

		setTimeout(function () {
			server.init(function () {
				console.log("token: ", authen.token);
				if (!authen.token) {
						email = bot.name;
						password = bot.pass;

						main.getHashService(password, function(err, res) {
						    main.authenUser(server, email, res, function (err, res) {
						        if (!err && res !== null) {
						            if (res.code === 200) {
						                console.log("Success Login User...");
						            }
						            else {
										alert("LOGIN FAIL");
						            }
						        }
						        else {
									alert("LOGIN FAIL");
						        }
							});
						});
				}
				else {
					server.TokenAuthen(authen.token, function (err, res) {
						if (!err && res !== null) {
							console.log("Authen result: ", JSON.stringify(res));
							if (res.success) {
							    main.authenUser(server, res.username, res.password, function (err, res) {
							        if (!err && res !== null) {
							            if (res.code === 200) {
							                console.log("Success Authen User...");
							            }
							            else {
							                //<!-- Authen fail.
											server.Logout(); alert('logout'); location.href='';
							            }
							        }
							        else {
							            //<!-- Authen fail.
										server.Logout(); alert('logout'); location.href='';
							        }
								});
							}
						}
					});
				}
			})
		}, 1500);
    </script>
</body>
</html>
